<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SpotBugsGui.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">spotbugs-maven-plugin</a> &gt; <a href="index.source.html" class="el_package">org.codehaus.mojo.spotbugs</a> &gt; <span class="el_source">SpotBugsGui.groovy</span></div><h1>SpotBugsGui.groovy</h1><pre class="source lang-java linenums">/*
 * Copyright 2005-2025 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.codehaus.mojo.spotbugs

import groovy.ant.AntBuilder

import java.nio.charset.Charset
import java.nio.charset.StandardCharsets
import java.nio.file.Files
import java.nio.file.Path
import javax.inject.Inject

import org.apache.maven.artifact.Artifact
import org.apache.maven.execution.MavenSession
import org.apache.maven.plugin.AbstractMojo
import org.apache.maven.plugins.annotations.Mojo
import org.apache.maven.plugins.annotations.Parameter
import org.apache.maven.plugins.annotations.ResolutionScope
import org.codehaus.plexus.resource.ResourceManager

/**
 * Launch the Spotbugs GUI.
 * It will use all the parameters in the POM fle.
 *
 * @since 2.0
 *
 * @description Launch the Spotbugs GUI using the parameters in the POM fle.
 */
@Mojo(name = 'gui', requiresDependencyResolution = ResolutionScope.TEST, requiresProject = true)
class SpotBugsGui extends AbstractMojo implements SpotBugsPluginsTrait {

    /** Locale to use for Resource bundle. */
    static Locale locale = Locale.ENGLISH

    /** Directory containing the class files for Spotbugs to analyze. */
    @Parameter(defaultValue = '${project.build.outputDirectory}', required = true)
    File classFilesDirectory

    /** Turn on Spotbugs debugging. */
    @Parameter(defaultValue = 'false', property = 'spotbugs.debug')
    boolean debug

    /** List of artifacts this plugin depends on. Used for resolving the Spotbugs core plugin. */
    @Parameter(property = 'plugin.artifacts', readonly = true, required = true)
    List&lt;Artifact&gt; pluginArtifacts

    /** Effort of the bug finders. Valid values are Min, Default and Max. */
    @Parameter(defaultValue = 'Default', property = 'spotbugs.effort')
    String effort

    /** The plugin list to include in the report. This is a SpotbugsInfo.COMMA-delimited list. */
    @Parameter(property = 'spotbugs.pluginList')
    String pluginList

    /**
     * Collection of PluginArtifact to work on. (PluginArtifact contains groupId, artifactId, version, type, classifier.)
     * See &lt;a href=&quot;./usage.html#Using Detectors from a Repository&quot;&gt;Usage&lt;/a&gt; for details.
     *
     * @since 2.4.1
     * @since 4.8.3.0 includes classifier
     */
    @Parameter
    List&lt;PluginArtifact&gt; plugins

    /** Artifact resolver, needed to download the plugin jars. */
    @Inject
    org.eclipse.aether.RepositorySystem repositorySystem

    /** Used to look up Artifacts in the remote repository. */
    @Inject
    org.apache.maven.repository.RepositorySystem factory

    /** Maven Session. */
    @Parameter (defaultValue = '${session}', readonly = true, required = true)
    MavenSession session

    /** Specifies the directory where the Spotbugs native xml output will be generated. */
    @Parameter(defaultValue = '${project.build.directory}', required = true)
    File spotbugsXmlOutputDirectory

    /**
     * Set the name of the output XML file produced
     *
     * @since 3.1.12.2
     */
    @Parameter(defaultValue = 'spotbugsXml.xml', property = 'spotbugs.outputXmlFilename')
    String spotbugsXmlOutputFilename

    /**
     * The file encoding to use when reading the source files. If the property &lt;code&gt;project.build.sourceEncoding&lt;/code&gt;
     * is not set, the platform default encoding is used. &lt;strong&gt;Note:&lt;/strong&gt; This parameter always overrides the
     * property &lt;code&gt;charset&lt;/code&gt; from Checkstyle's &lt;code&gt;TreeWalker&lt;/code&gt; module.
     *
     * @since 2.2
     */
    @Parameter(defaultValue = '${project.build.sourceEncoding}', property = 'encoding')
    String encoding

    /**
     * Maximum Java heap size in megabytes  (default=512).
     *
     * @since 2.2
     */
    @Parameter(defaultValue = '512', property = 'spotbugs.maxHeap')
    int maxHeap

    /**
     * Resource Manager.
     *
     * @since 2.0
     */
    @Inject
    ResourceManager resourceManager

    @Override
    void execute() {

<span class="nc" id="L131">        List&lt;String&gt; auxClasspathElements = session.getCurrentProject().compileClasspathElements</span>

<span class="nc bnc" id="L133" title="All 6 branches missed.">        if (debug &amp;&amp; log.isInfoEnabled()) {</span>
<span class="nc" id="L134">            log.info(&quot;  Plugin Artifacts to be added -&gt; ${pluginArtifacts}&quot;)</span>
        }

<span class="nc" id="L137">        Charset effectiveEncoding</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (encoding) {</span>
<span class="nc" id="L139">            effectiveEncoding = Charset.forName(encoding)</span>
        } else {
<span class="nc bnc" id="L141" title="All 2 branches missed.">            effectiveEncoding = Charset.defaultCharset() ?: StandardCharsets.UTF_8</span>
        }
<span class="nc bnc" id="L143" title="All 2 branches missed.">        if (log.isInfoEnabled()) {</span>
<span class="nc" id="L144">            log.info('File Encoding is ' + effectiveEncoding.name())</span>
        }

        // options must be added before the spotbugsXml path
<span class="nc" id="L148">        List&lt;String&gt; spotbugsArgs = []</span>
<span class="nc" id="L149">        spotbugsArgs &lt;&lt; getEffortParameter()</span>
<span class="nc bnc" id="L150" title="All 6 branches missed.">        if (pluginList || plugins) {</span>
<span class="nc" id="L151">            spotbugsArgs &lt;&lt; '-pluginList'</span>
<span class="nc" id="L152">            spotbugsArgs &lt;&lt; getSpotbugsPlugins()</span>
        }

<span class="nc" id="L155">        AntBuilder ant = new AntBuilder()</span>
<span class="nc" id="L156">        ant.project.setProperty('basedir', spotbugsXmlOutputDirectory.getAbsolutePath())</span>
<span class="nc" id="L157">        ant.project.setProperty('verbose', 'true')</span>

<span class="nc" id="L159">        ant.java(classname: 'edu.umd.cs.findbugs.LaunchAppropriateUI', fork: 'true', failonerror: 'true', clonevm: 'true', maxmemory: &quot;${maxHeap}m&quot;) {</span>

<span class="nc" id="L161">            sysproperty(key: 'file.encoding' , value: effectiveEncoding.name())</span>

            // spotbugs assumes that multiple arguments (because of options) means text mode, so need to request gui explicitly
<span class="nc" id="L164">            jvmarg(value: '-Dfindbugs.launchUI=gui2')</span>

<span class="nc" id="L166">            spotbugsArgs.each { String spotbugsArg -&gt;</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                if (log.isDebugEnabled()) {</span>
<span class="nc" id="L168">                    log.debug(&quot;Spotbugs arg is ${spotbugsArg}&quot;)</span>
                }
<span class="nc" id="L170">                arg(value: spotbugsArg)</span>
            }

<span class="nc" id="L173">            Path spotbugsXml = spotbugsXmlOutputDirectory.toPath().resolve(spotbugsXmlOutputFilename)</span>

<span class="nc bnc" id="L175" title="All 2 branches missed.">            if (Files.exists(spotbugsXml)) {</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">                if (log.isDebugEnabled()) {</span>
<span class="nc" id="L177">                    log.debug(&quot;  Found an SpotBugs XML at -&gt; ${spotbugsXml}&quot;)</span>
                }
<span class="nc" id="L179">                arg(value: spotbugsXml)</span>
            }

<span class="nc" id="L182">            classpath() {</span>

<span class="nc" id="L184">                pluginArtifacts.each() { Artifact pluginArtifact -&gt;</span>
<span class="nc bnc" id="L185" title="All 6 branches missed.">                    if (debug &amp;&amp; log.isInfoEnabled()) {</span>
<span class="nc" id="L186">                        log.info(&quot;  Trying to Add to pluginArtifact -&gt; ${pluginArtifact.file}&quot;)</span>
                    }

<span class="nc" id="L189">                    pathelement(location: pluginArtifact.file)</span>
                }
            }
        }
<span class="nc" id="L193">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>