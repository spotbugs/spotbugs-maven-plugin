<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>XDocsReporter.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">spotbugs-maven-plugin</a> &gt; <a href="index.source.html" class="el_package">org.codehaus.mojo.spotbugs</a> &gt; <span class="el_source">XDocsReporter.groovy</span></div><h1>XDocsReporter.groovy</h1><pre class="source lang-java linenums">/*
 * Copyright 2005-2025 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.codehaus.mojo.spotbugs

import edu.umd.cs.findbugs.Version

import groovy.xml.slurpersupport.GPathResult
import groovy.xml.slurpersupport.NodeChild
import groovy.xml.StreamingMarkupBuilder
import java.nio.charset.Charset

import org.apache.maven.plugin.logging.Log

/**
 * The reporter controls the generation of the Spotbugs report.
 */
class XDocsReporter {

    /** The key to get the value if the line number is not available. */
    static final String NOLINE_KEY = 'report.spotbugs.noline'

    /** The bundle to get the messages from. */
    ResourceBundle bundle

    /** The logger to write logs to. */
    Log log

    /** The threshold of bugs severity. */
    String threshold

    /** The used effort for searching bugs. */
    String effort

    /** The output Writer stream. */
    Writer outputWriter

    /** Spotbugs Results. */
    GPathResult spotbugsResults

    /** Bug Classes. */
<span class="fc" id="L54">    List&lt;String&gt; bugClasses = []</span>

    /** The directories containing the sources to be compiled. */
<span class="fc" id="L57">    List&lt;String&gt; compileSourceRoots = []</span>

    /** The directories containing the test sources to be compiled. */
<span class="fc" id="L60">    List&lt;String&gt; testSourceRoots = []</span>

    /** The output encoding. */
    Charset outputEncoding

    /**
     * Default constructor.
     *
     * @param bundle
     *            The Resource Bundle to use
     */
<span class="fc" id="L71">    XDocsReporter(ResourceBundle bundle, Log log, String threshold, String effort, String outputEncoding) {</span>
<span class="pc bpc" id="L72" title="14 of 28 branches missed.">        if (!bundle || !log || !threshold || !effort || !outputEncoding) {</span>
<span class="nc" id="L73">            throw new IllegalArgumentException('All constructor arguments must be provided')</span>
        }

<span class="fc" id="L76">        this.bundle = bundle</span>
<span class="fc" id="L77">        this.log = log</span>
<span class="fc" id="L78">        this.threshold = threshold</span>
<span class="fc" id="L79">        this.effort = effort</span>
<span class="fc" id="L80">        this.outputEncoding = Charset.forName(outputEncoding)</span>
<span class="fc" id="L81">    }</span>

    /**
     * Returns the threshold string value for the integer input.
     *
     * @param thresholdValue
     *            The ThresholdValue integer to evaluate.
     * @return The string valueof the Threshold object.
     */
    protected String evaluateThresholdParameter(String thresholdValue) {
<span class="fc" id="L91">        switch (thresholdValue) {</span>
<span class="pc bfc" id="L92" title="All 2 branches covered.">            case '1': return 'High'</span>
<span class="pc bfc" id="L93" title="All 2 branches covered.">            case '2': return 'Normal'</span>
<span class="pc bfc" id="L94" title="All 2 branches covered.">            case '3': return 'Low'</span>
<span class="pc bfc" id="L95" title="All 2 branches covered.">            case '4': return 'Exp'</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">            case '5': return 'Ignore'</span>
<span class="fc" id="L97">            default: return 'Invalid Priority'</span>
        }
<span class="nc" id="L99">    }</span>

    /**
     * Gets the Spotbugs Version of the report.
     *
     * @return The Spotbugs Version used on the report.
     */
    protected String getSpotBugsVersion() {
<span class="fc" id="L107">        return Version.VERSION_STRING</span>
    }

    public void generateReport() {
<span class="fc" id="L111">        StreamingMarkupBuilder xmlBuilder = new StreamingMarkupBuilder()</span>
<span class="fc" id="L112">        xmlBuilder.encoding = outputEncoding.name()</span>

<span class="fc" id="L114">        outputWriter &lt;&lt; xmlBuilder.bind {</span>
<span class="fc" id="L115">            mkp.xmlDeclaration()</span>
<span class="pc bpc" id="L116" title="1 of 2 branches missed.">            if (log.isDebugEnabled()) {</span>
<span class="nc" id="L117">                log.debug(&quot;generateReport spotbugsResults is ${spotbugsResults}&quot;)</span>
            }

<span class="fc" id="L120">            BugCollection(version: getSpotBugsVersion(), threshold: SpotBugsInfo.spotbugsThresholds[threshold],</span>
<span class="fc" id="L121">                    effort: SpotBugsInfo.spotbugsEfforts[effort]) {</span>

<span class="pc bpc" id="L123" title="1 of 2 branches missed.">                if (log.isDebugEnabled()) {</span>
<span class="nc" id="L124">                    log.debug(&quot;spotbugsResults.FindBugsSummary total_bugs is ${spotbugsResults.FindBugsSummary.@total_bugs.text()}&quot;)</span>
                }

<span class="fc" id="L127">                spotbugsResults.FindBugsSummary.PackageStats.ClassStats.each() { NodeChild classStats -&gt;</span>

<span class="fc" id="L129">                    String classStatsValue = classStats.'@class'.text()</span>
<span class="fc" id="L130">                    String classStatsBugCount = classStats.'@bugs'.text()</span>

<span class="pc bpc" id="L132" title="1 of 2 branches missed.">                    if (log.isDebugEnabled()) {</span>
<span class="nc" id="L133">                        log.debug('classStats...')</span>
<span class="nc" id="L134">                        log.debug(&quot;classStatsValue is ${classStatsValue}&quot;)</span>
<span class="nc" id="L135">                        log.debug(&quot;classStatsBugCount is ${classStatsBugCount}&quot;)</span>
                    }

<span class="pc bpc" id="L138" title="1 of 2 branches missed.">                    if (Integer.parseInt(classStatsBugCount) &gt; 0) {</span>
<span class="nc" id="L139">                        bugClasses &lt;&lt; classStatsValue</span>
                    }
<span class="fc" id="L141">                }</span>

<span class="fc" id="L143">                bugClasses.each() { String bugClass -&gt;</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                    if (log.isDebugEnabled()) {</span>
<span class="nc" id="L145">                        log.debug(&quot;finish bugClass is ${bugClass}&quot;)</span>
                    }
<span class="nc" id="L147">                    file(classname: bugClass) {</span>
<span class="nc" id="L148">                        spotbugsResults.BugInstance.each() { NodeChild bugInstance -&gt;</span>

<span class="nc bnc" id="L150" title="All 2 branches missed.">                            if (bugInstance.Class.find{ NodeChild classNode -&gt; classNode.@primary == &quot;true&quot; }.@classname.text() != bugClass) {</span>
<span class="nc" id="L151">                                return</span>
                            }

<span class="nc" id="L154">                            String type = bugInstance.@type.text()</span>
<span class="nc" id="L155">                            String category = bugInstance.@category.text()</span>
<span class="nc" id="L156">                            String message = bugInstance.LongMessage.text()</span>
<span class="nc" id="L157">                            String priority = evaluateThresholdParameter(bugInstance.@priority.text())</span>
<span class="nc" id="L158">                            String line = bugInstance.SourceLine.@start[0].text()</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">                            if (log.isDebugEnabled()) {</span>
<span class="nc" id="L160">                                log.debug(&quot;BugInstance message is ${message}&quot;)</span>
                            }

<span class="nc" id="L163">                            BugInstance(type: type, priority: priority, category: category, message: message,</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">                                    lineNumber: ((line) ? line: &quot;-1&quot;))</span>
                        }
                    }
                }

<span class="fc" id="L169">                log.debug(&quot;Printing Errors&quot;)</span>

<span class="fc" id="L171">                Error() {</span>
<span class="fc" id="L172">                    spotbugsResults.Error.analysisError.each() { NodeChild analysisError -&gt;</span>
<span class="fc" id="L173">                        AnalysisError(analysisError.message.text())</span>
                    }

<span class="fc" id="L176">                    log.debug(&quot;Printing Missing classes&quot;)</span>

<span class="fc" id="L178">                    spotbugsResults.Error.MissingClass.each() { NodeChild missingClass -&gt;</span>
<span class="fc" id="L179">                        MissingClass(missingClass.text)</span>
                    }
                }

<span class="fc" id="L183">                Project() {</span>
<span class="fc" id="L184">                    log.debug(&quot;Printing Source Roots&quot;)</span>

<span class="pc bpc" id="L186" title="2 of 4 branches missed.">                    if (!compileSourceRoots.isEmpty()) {</span>
<span class="fc" id="L187">                        compileSourceRoots.each() { String srcDir -&gt;</span>
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">                            if (log.isDebugEnabled()) {</span>
<span class="nc" id="L189">                                log.debug(&quot;SrcDir is ${srcDir}&quot;)</span>
                            }
<span class="fc" id="L191">                            SrcDir(srcDir)</span>
                        }
                    }

<span class="pc bpc" id="L195" title="2 of 4 branches missed.">                    if (!testSourceRoots.isEmpty()) {</span>
<span class="fc" id="L196">                        testSourceRoots.each() { String srcDir -&gt;</span>
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">                            if (log.isDebugEnabled()) {</span>
<span class="nc" id="L198">                                log.debug(&quot;SrcDir is ${srcDir}&quot;)</span>
                            }
<span class="fc" id="L200">                            SrcDir(srcDir)</span>
                        }
                    }
<span class="nc" id="L203">                }</span>
            }
        }

<span class="fc" id="L207">        outputWriter.close()</span>
<span class="fc" id="L208">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>